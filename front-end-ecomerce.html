<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JJ-Commerce</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBn5jowfCEajY+waCDt+T+tFYA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5; /* Couleur de fond Messenger */
            padding-top: 70px; /* Pour éviter que le contenu ne soit caché par la barre de navigation fixe */
        }

        .messenger-container {
            max-width: 960px;
            margin: auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            min-height: calc(100vh - 80px); /* Ajuster la hauteur */
            display: flex;
            flex-direction: column;
        }

        .messenger-header {
            background-color: #0084ff !important; /* Couleur bleue Messenger */
            color: white;
            border-bottom: 1px solid #006acc;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .messenger-header .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }

        .messenger-body {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto; /* Permet le défilement du contenu */
        }

        /* Style des cartes produits */
        .product-card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease-in-out;
            margin-bottom: 20px;
            overflow: hidden; /* Pour gérer le border-radius avec l'image */
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-card img {
            height: 200px;
            object-fit: contain; /* Assure que l'image est bien contenue */
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            padding: 10px; /* Espace autour de l'image */
            background-color: #f8f9fa; /* Fond clair pour les images */
        }

        .product-card .card-body {
            padding: 15px;
        }

        .product-card .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            min-height: 50px; /* Pour une hauteur uniforme des titres */
        }

        .product-card .card-text {
            font-size: 0.9rem;
            color: #666;
            height: 60px; /* Hauteur fixe pour la description */
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3; /* Limite à 3 lignes */
            -webkit-box-orient: vertical;
        }

        .product-card .product-price {
            font-size: 1.4rem;
            font-weight: bold;
            color: #0084ff; /* Prix en bleu Messenger */
        }

        .product-card .btn-add-to-cart {
            background-color: #0084ff;
            border-color: #0084ff;
            transition: background-color 0.2s;
        }

        .product-card .btn-add-to-cart:hover {
            background-color: #006acc;
            border-color: #006acc;
        }

        /* Styles du panier */
        .cart-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .cart-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .cart-item img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-right: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .cart-item-details {
            flex-grow: 1;
        }

        .cart-item-details h6 {
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .cart-item-details .text-muted {
            font-size: 0.9em;
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
        }

        .cart-item-actions .quantity-input {
            width: 60px;
            text-align: center;
            margin: 0 10px;
        }

        .cart-item-actions .btn-sm {
            font-size: 0.8rem;
            padding: 0.3rem 0.6rem;
        }

        /* Modale de commande */
        #checkoutForm label {
            font-weight: 500;
        }

        /* Spinner de chargement */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            min-height: 300px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .messenger-container {
                border-radius: 0;
                box-shadow: none;
            }

            .messenger-body {
                padding: 10px;
            }

            .product-card img {
                height: 150px;
            }

            .product-card .card-title {
                font-size: 1rem;
                min-height: auto;
            }

            .product-card .card-text {
                height: auto;
                -webkit-line-clamp: unset;
            }
        }

        /* Style pour la barre de recherche */
        .search-bar-container {
            flex-grow: 1;
            margin-left: 15px; /* Espace entre le brand et la barre de recherche */
            margin-right: 15px; /* Espace entre la barre de recherche et le panier */
        }

        .search-bar-container .form-control {
            border-radius: 20px; /* Bords arrondis */
            padding-left: 1.5rem; /* Espace pour l'icône de loupe */
            background-color: rgba(255, 255, 255, 0.2); /* Fond semi-transparent */
            border: none;
            color: white;
        }

        .search-bar-container .form-control::placeholder {
            color: rgba(255, 255, 255, 0.7); /* Couleur du placeholder */
        }

        .search-bar-container .form-control:focus {
            background-color: white; /* Fond blanc au focus */
            color: #333; /* Texte noir au focus */
            box-shadow: none;
        }

        /* Positionnement de l'icône de recherche */
        .search-input-group {
            position: relative;
        }

        .search-input-group .fa-search {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.7);
            z-index: 5;
        }

        .search-input-group .form-control:focus + .fa-search {
            color: #0084ff; /* Couleur de l'icône au focus */
        }

        @media (max-width: 991.98px) { /* Pour les écrans plus petits que large (lg) */
            .search-bar-container {
                margin-left: 0;
                margin-right: 0;
                margin-top: 10px; /* Espace au-dessus sur mobile */
                width: 100%; /* Pleine largeur sur mobile */
            }
            .navbar-collapse {
                padding-bottom: 10px; /* Espace sous la barre de recherche sur mobile */
            }
        }

        /* Styles pour les nouvelles sections statiques */
        .static-sections {
            padding: 20px;
            background-color: #f0f2f5; /* Fond légèrement différent pour les sections statiques */
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
        }

        .whatsapp-section, .promo-section {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 30px;
        }

        .whatsapp-section h3, .promo-section h3 {
            color: #0084ff;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .whatsapp-section .btn-success {
            background-color: #25D366; /* Vert WhatsApp */
            border-color: #25D366;
            font-size: 1.2rem;
            padding: 10px 25px;
            border-radius: 30px;
            transition: background-color 0.2s ease-in-out;
        }

        .whatsapp-section .btn-success:hover {
            background-color: #1DA851;
            border-color: #1DA851;
        }

        .promo-section img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .messenger-footer {
            background-color: #333; /* Fond sombre pour le footer */
            color: rgba(255, 255, 255, 0.7);
            padding: 20px;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            font-size: 0.9rem;
        }

        .messenger-footer .fas {
            color: #e74c3c; /* Cœur rouge */
        }

        /* Styles pour le carousel */
        .carousel-item img {
            max-height: 300px; /* Hauteur maximale pour les images du carousel */
            object-fit: cover; /* Recadre l'image pour couvrir l'espace */
            width: 100%; /* Assure que l'image remplit la largeur */
            border-radius: 8px;
        }
        .carousel-caption {
            background-color: rgba(0, 0, 0, 0.5); /* Fond semi-transparent pour le texte */
            border-radius: 5px;
            padding: 10px;
        }
    </style>
</head>
<body>
    <div class="container-fluid messenger-container">
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top messenger-header">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-store"></i> JJ-Commerce
                </a>
                <div class="search-bar-container d-none d-lg-block">
                    <div class="input-group search-input-group">
                        <input type="search" class="form-control" placeholder="Rechercher un produit..." id="searchInput">
                        <i class="fas fa-search"></i>
                    </div>
                </div>

                <div class="d-flex align-items-center">
                    <button class="btn btn-primary position-relative me-3" id="cartBtn">
                        <i class="fas fa-shopping-cart fa-lg"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="cartCount">
                            0
                            <span class="visually-hidden">articles dans le panier</span>
                        </span>
                    </button>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <div class="search-bar-container d-block d-lg-none mt-3 mb-2">
                        <div class="input-group search-input-group">
                            <input type="search" class="form-control" placeholder="Rechercher un produit..." id="searchInputMobile">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#" id="homeLink"><i class="fas fa-home"></i> Accueil</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="orderHistoryLink"><i class="fas fa-history"></i> Mes Commandes</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="messenger-body" id="appContent">
            <div class="loading-spinner">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Chargement...</span>
                </div>
            </div>
        </div>

        <div class="static-sections p-4">
            <section class="whatsapp-section text-center mb-5 p-4">
                <h3><i class="fab fa-whatsapp"></i> Nous Contacter sur WhatsApp</h3>
                <p class="lead">Besoin d'aide ou d'informations ? Contactez-nous directement pour une assistance rapide !</p>
                <a href="https://wa.me/243812345678" target="_blank" class="btn btn-success btn-lg">
                    <i class="fab fa-whatsapp"></i> Envoyer un message
                </a>
            </section>

            <section class="promo-section text-center mb-5 p-4">
                <h3><i class="fas fa-bullhorn"></i> Nos Offres Spéciales !</h3>
                <p>Profitez de réductions incroyables sur une sélection d'articles. Ne manquez pas nos promotions exclusives !</p>
                <img src="https://placehold.co/600x200/0084ff/ffffff?text=Publicite+JJ-Commerce" alt="Publicité JJ-Commerce" class="img-fluid rounded mb-3">
                <p class="text-muted">Offre limitée ! Visitez notre boutique pour en savoir plus.</p>
            </section>
        </div>

        <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="cartModalLabel"><i class="fas fa-shopping-cart"></i> Votre Panier</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="cartItemsContainer">
                        <p class="text-center text-muted" id="emptyCartMessage">Votre panier est vide.</p>
                    </div>
                    <div class="modal-footer d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Total: <span id="cartTotal">0.00€</span></h5>
                        <div>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Continuer vos achats</button>
                            <button type="button" class="btn btn-success" id="checkoutBtn"><i class="fas fa-cash-register"></i> Passer la commande</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="orderConfirmationModal" tabindex="-1" aria-labelledby="orderConfirmationModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title" id="orderConfirmationModalLabel"><i class="fas fa-check-circle"></i> Commande Confirmée !</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-center">
                        <p class="lead">Merci pour votre commande !</p>
                        <p>Le paiement se fera sur place, à la livraison.</p>
                        <p>Nous vous contacterons bientôt pour confirmer. Votre numéro de commande est : <strong id="orderNumberDisplay">#XXXXXX</strong></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Fermer</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

        <footer class="messenger-footer text-center">
            <p>&copy; 2024 JJ-Commerce. Tous droits réservés.</p>
            <p>Développé avec <i class="fas fa-heart text-danger"></i> pour vous.</p>
        </footer>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eGbF8s1hS2mt0n2u" crossorigin="anonymous"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Récupération des éléments du DOM
            const appContent = document.getElementById('appContent');
            const cartBtn = document.getElementById('cartBtn');
            const cartCount = document.getElementById('cartCount');
            const cartModal = new bootstrap.Modal(document.getElementById('cartModal'));
            const cartItemsContainer = document.getElementById('cartItemsContainer');
            const cartTotalElement = document.getElementById('cartTotal');
            const emptyCartMessage = document.getElementById('emptyCartMessage');
            const checkoutBtn = document.getElementById('checkoutBtn');
            const orderConfirmationModal = new bootstrap.Modal(document.getElementById('orderConfirmationModal'));
            const orderNumberDisplay = document.getElementById('orderNumberDisplay');
            const homeLink = document.getElementById('homeLink');
            const orderHistoryLink = document.getElementById('orderHistoryLink');
            const searchInput = document.getElementById('searchInput'); // Barre de recherche desktop
            const searchInputMobile = document.getElementById('searchInputMobile'); // Barre de recherche mobile

            // Initialisation du panier depuis le localStorage ou un tableau vide
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            // Tableau pour stocker les produits chargés de l'API
            let allProducts = []; // Renommé pour stocker tous les produits non filtrés

            // --- Fonctions utilitaires ---

            /**
             * Affiche un spinner de chargement dans le contenu principal de l'application.
             */
            function showLoadingSpinner() {
                appContent.innerHTML = `
                    <div class="loading-spinner">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Chargement...</span>
                        </div>
                    </div>
                `;
                console.log('Spinner de chargement affiché.');
            }

            /**
             * Formate un prix en devise (€) avec deux décimales.
             * @param {number} price - Le prix à formater.
             * @returns {string} Le prix formaté.
             */
            function formatPrice(price) {
                return price.toFixed(2) + '€';
            }

            /**
             * Met à jour le nombre d'articles dans l'icône du panier.
             */
            function updateCartCount() {
                cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
                console.log('Compteur du panier mis à jour:', cartCount.textContent);
            }

            /**
             * Calcule le total du panier.
             * @returns {number} Le total des prix des articles dans le panier.
             */
            function calculateCartTotal() {
                const total = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
                console.log('Total du panier calculé:', total);
                return total;
            }

            // --- Fonctions de rendu de l'interface utilisateur ---

            /**
             * Charge et affiche les produits. Peut prendre un tableau de produits filtrés.
             * @param {Array<Object>} [productsToRenderParam=null] - Les produits à afficher. Par défaut, tous les produits.
             */
            async function renderProducts(productsToRenderParam = null) {
                let productsToDisplay = productsToRenderParam;

                if (productsToDisplay === null) {
                    if (allProducts.length === 0) {
                        // Products not yet loaded, fetch them
                        showLoadingSpinner();
                        console.log('Début du chargement des produits depuis l\'API...');
                        try {
                            const response = await fetch('https://fakestoreapi.com/products');
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            allProducts = await response.json(); // Store all fetched products
                            productsToDisplay = allProducts; // Set for display
                            console.log('Produits chargés depuis l\'API:', allProducts.length, 'articles.');
                        } catch (error) {
                            console.error('Erreur lors du chargement des produits depuis l\'API:', error);
                            appContent.innerHTML = `<p class="text-danger text-center">Impossible de charger les produits. Veuillez réessayer plus tard. Erreur: ${error.message}</p>`;
                            return; // Stop execution if fetch fails
                        }
                    } else {
                        // Products already loaded, use them
                        productsToDisplay = allProducts;
                    }
                }

                // Ensure productsToDisplay is an array before proceeding
                if (!Array.isArray(productsToDisplay)) {
                    console.error('productsToDisplay n\'est pas un tableau:', productsToDisplay);
                    appContent.innerHTML = `<p class="text-danger text-center">Une erreur inattendue est survenue lors de l'affichage des produits.</p>`;
                    return;
                }

                let productsHtml = `
                    <div class="alert alert-info text-center" role="alert">
                        Bienvenue sur **JJ-Commerce** ! Découvrez nos offres exclusives.
                    </div>`;

                // Add carousel only if displaying all products (not filtered search results)
                if (productsToRenderParam === null || productsToRenderParam === allProducts) {
                    productsHtml += `
                        <div id="productCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
                            <div class="carousel-indicators">
                                <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                                <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                                <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
                            </div>
                            <div class="carousel-inner">
                                <div class="carousel-item active">
                                    <img src="https://placehold.co/900x300/FF5733/ffffff?text=Grande+Promotion" class="d-block w-100" alt="Promotion 1">
                                    <div class="carousel-caption d-none d-md-block">
                                        <h5>Offres Flash du Jour !</h5>
                                        <p>Ne manquez pas nos réductions incroyables sur une sélection d'articles.</p>
                                    </div>
                                </div>
                                <div class="carousel-item">
                                    <img src="https://placehold.co/900x300/33FF57/ffffff?text=Nouveautes+Exclusives" class="d-block w-100" alt="Nouveautés">
                                    <div class="carousel-caption d-none d-md-block">
                                        <h5>Découvrez nos Nouveautés</h5>
                                        <p>Les dernières tendances et produits innovants sont arrivés !</p>
                                    </div>
                                </div>
                                <div class="carousel-item">
                                    <img src="https://placehold.co/900x300/3357FF/ffffff?text=Livraison+Gratuite" class="d-block w-100" alt="Livraison Gratuite">
                                    <div class="carousel-caption d-none d-md-block">
                                        <h5>Livraison Gratuite sur toutes les commandes !</h5>
                                        <p>Profitez de nos services de livraison rapide et sans frais.</p>
                                    </div>
                                </div>
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>
                    `;
                }


                productsHtml += `<h2 class="mb-4 text-center"><i class="fas fa-th-large"></i> Nos Derniers Produits</h2>
                                <div class="row">`; // Début de la grille de produits

                // Vérifie si productsToDisplay est vide et ajuste le message.
                if (productsToDisplay.length === 0) {
                    productsHtml += `<p class="text-center text-muted col-12">Aucun produit ne correspond à votre recherche.</p>`;
                } else {
                    productsToDisplay.forEach(product => {
                        productsHtml += `
                            <div class="col-md-4 col-sm-6 mb-4">
                                <div class="card product-card h-100">
                                    <img src="${product.image}" class="card-img-top" alt="${product.title}">
                                    <div class="card-body d-flex flex-column">
                                        <h5 class="card-title">${product.title}</h5>
                                        <p class="card-text">${product.description}</p>
                                        <div class="mt-auto d-flex justify-content-between align-items-center">
                                            <span class="product-price">${formatPrice(product.price)}</span>
                                            <button class="btn btn-primary btn-add-to-cart" data-product-id="${product.id}">
                                                <i class="fas fa-cart-plus"></i> Ajouter au panier
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }

                productsHtml += `</div>`; // Fin de la grille de produits

                // Section des catégories (simple visualisation, non fonctionnelle pour le filtrage ici)
                productsHtml += `
                    <div class="mt-5 p-3 bg-light rounded shadow-sm">
                        <h5 class="mb-3"><i class="fas fa-tags"></i> Catégories Populaires</h5>
                        <div class="d-flex flex-wrap gap-2">
                            <span class="badge bg-secondary">Électronique</span>
                            <span class="badge bg-secondary">Bijoux</span>
                            <span class="badge bg-secondary">Vêtements Homme</span>
                            <span class="badge bg-secondary">Vêtements Femme</span>
                            <span class="badge bg-secondary">Articles de Maison</span>
                            <span class="badge bg-secondary">Sport & Loisirs</span>
                        </div>
                    </div>
                `;


                appContent.innerHTML = productsHtml; // Injecte le HTML dans le DOM
                attachAddToCartListeners(); // Attache les écouteurs d'événements aux boutons "Ajouter au panier"
                console.log('Produits affichés sur la page d\'accueil (filtrés si applicable).');
            }

            /**
             * Attache les écouteurs d'événements aux boutons "Ajouter au panier".
             */
            function attachAddToCartListeners() {
                document.querySelectorAll('.btn-add-to-cart').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const productId = parseInt(event.currentTarget.dataset.productId);
                        addProductToCart(productId);
                    });
                });
                console.log('Écouteurs "Ajouter au panier" attachés.');
            }

            /**
             * Affiche les articles du panier dans la modale du panier.
             */
            function renderCartItems() {
                cartItemsContainer.innerHTML = ''; // Vide le conteneur actuel
                console.log('Rendu des articles du panier. Panier actuel:', cart);
                if (cart.length === 0) {
                    emptyCartMessage.style.display = 'block'; // Affiche le message "panier vide"
                    checkoutBtn.disabled = true; // Désactive le bouton de commande
                    console.log('Panier vide, message affiché.');
                } else {
                    emptyCartMessage.style.display = 'none'; // Cache le message "panier vide"
                    checkoutBtn.disabled = false; // Active le bouton de commande
                    // Génère le HTML pour chaque article du panier
                    cart.forEach(item => {
                        const cartItemHtml = `
                            <div class="cart-item" data-product-id="${item.id}">
                                <img src="${item.image}" alt="${item.title}">
                                <div class="cart-item-details">
                                    <h6>${item.title}</h6>
                                    <p class="text-muted mb-1">${formatPrice(item.price)}</p>
                                    <p class="text-muted">Sous-total: ${formatPrice(item.price * item.quantity)}</p>
                                </div>
                                <div class="cart-item-actions">
                                    <button class="btn btn-outline-secondary btn-sm decrease-quantity"><i class="fas fa-minus"></i></button>
                                    <input type="number" class="form-control form-control-sm quantity-input" value="${item.quantity}" min="1" readonly>
                                    <button class="btn btn-outline-secondary btn-sm increase-quantity"><i class="fas fa-plus"></i></button>
                                    <button class="btn btn-danger btn-sm ms-2 remove-from-cart"><i class="fas fa-trash-alt"></i></button>
                                </div>
                            </div>
                        `;
                        cartItemsContainer.insertAdjacentHTML('beforeend', cartItemHtml);
                    });
                    attachCartItemListeners(); // Attache les écouteurs d'événements aux boutons du panier
                    console.log('Articles du panier affichés.');
                }
                cartTotalElement.textContent = formatPrice(calculateCartTotal()); // Met à jour le total
                updateCartCount(); // Met à jour le compteur du panier
            }

            /**
             * Attache les écouteurs d'événements aux boutons de quantité et de suppression dans le panier.
             */
            function attachCartItemListeners() {
                cartItemsContainer.querySelectorAll('.increase-quantity').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const productId = parseInt(event.target.closest('.cart-item').dataset.productId);
                        changeQuantity(productId, 1);
                    });
                });

                cartItemsContainer.querySelectorAll('.decrease-quantity').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const productId = parseInt(event.target.closest('.cart-item').dataset.productId);
                        changeQuantity(productId, -1);
                    });
                });

                cartItemsContainer.querySelectorAll('.remove-from-cart').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const productId = parseInt(event.target.closest('.cart-item').dataset.productId);
                        removeProductFromCart(productId);
                    });
                });
                console.log('Écouteurs d\'événements du panier attachés.');
            }

            /**
             * Affiche le formulaire de commande.
             */
            function renderCheckoutForm() {
                appContent.innerHTML = `
                    <h2 class="mb-4 text-center"><i class="fas fa-cash-register"></i> Passer votre commande</h2>
                    <div class="card p-4 shadow-sm">
                        <form id="checkoutForm">
                            <div class="mb-3">
                                <label for="fullName" class="form-label">Nom complet</label>
                                <input type="text" class="form-control" id="fullName" required>
                            </div>
                            <div class="mb-3">
                                <label for="phoneNumber" class="form-label">Numéro de téléphone</label>
                                <input type="tel" class="form-control" id="phoneNumber" placeholder="Ex: +243 812345678" required>
                            </div>
                            <div class="mb-3">
                                <label for="address" class="form-label">Adresse de livraison</label>
                                <textarea class="form-control" id="address" rows="3" required></textarea>
                            </div>
                            <hr>
                            <h5 class="mb-3">Récapitulatif de la commande</h5>
                            <ul class="list-group mb-3" id="orderSummaryList">
                                </ul>
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5>Total à payer sur place:</h5>
                                <h4 class="text-primary" id="finalOrderTotal">${formatPrice(calculateCartTotal())}</h4>
                            </div>
                            <p class="text-muted text-center"><i class="fas fa-info-circle"></i> Le paiement se fera en espèces sur place à la livraison.</p>
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-success btn-lg"><i class="fas fa-paper-plane"></i> Confirmer la commande</button>
                                <button type="button" class="btn btn-outline-secondary" id="backToCartBtn"><i class="fas fa-arrow-left"></i> Retour au panier</button>
                            </div>
                        </form>
                    </div>
                `;
                renderOrderSummary(); // Affiche le récapitulatif des articles
                document.getElementById('checkoutForm').addEventListener('submit', handleCheckoutSubmit); // Attache l'écouteur de soumission du formulaire
                document.getElementById('backToCartBtn').addEventListener('click', () => {
                    appContent.innerHTML = ''; // Vide le contenu
                    renderProducts(); // Retourne à la page des produits
                    cartModal.show(); // Ouvre la modale du panier
                });
                console.log('Formulaire de commande affiché.');
            }

            /**
             * Affiche le récapitulatif des articles dans le formulaire de commande.
             */
            function renderOrderSummary() {
                const orderSummaryList = document.getElementById('orderSummaryList');
                orderSummaryList.innerHTML = '';
                cart.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center');
                    listItem.innerHTML = `
                        ${item.title} x ${item.quantity}
                        <span class="badge bg-primary rounded-pill">${formatPrice(item.price * item.quantity)}</span>
                    `;
                    orderSummaryList.appendChild(listItem);
                });
                console.log('Récapitulatif de la commande affiché.');
            }

            /**
             * Affiche l'historique des commandes stockées localement.
             */
            function renderOrderHistory() {
                showLoadingSpinner(); // Affiche le spinner pendant le chargement
                const orders = JSON.parse(localStorage.getItem('orderHistory')) || [];
                console.log('Rendu de l\'historique des commandes. Commandes trouvées:', orders.length);

                if (orders.length === 0) {
                    appContent.innerHTML = `
                        <div class="text-center p-5">
                            <i class="fas fa-box-open fa-5x text-muted mb-3"></i>
                            <h3 class="text-muted">Vous n'avez pas encore passé de commande.</h3>
                            <p>Commencez vos achats dès maintenant !</p>
                            <button class="btn btn-primary mt-3" id="startShoppingBtn"><i class="fas fa-store"></i> Retour à la boutique</button>
                        </div>
                    `;
                    // Utiliser une fonction fléchée pour s'assurer que renderProducts est appelée sans arguments
                    document.getElementById('startShoppingBtn').addEventListener('click', () => renderProducts());
                    console.log('Historique des commandes vide, message affiché.');
                    return;
                }

                let orderHistoryHtml = `
                    <h2 class="mb-4 text-center"><i class="fas fa-history"></i> Votre Historique de Commandes</h2>
                    <div class="accordion" id="orderAccordion">
                `;
                // Génère le HTML pour chaque commande dans l'historique
                orders.forEach((order, index) => {
                    orderHistoryHtml += `
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="heading${index}">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${index}" aria-expanded="false" aria-controls="collapse${index}">
                                    Commande #${order.orderId} - ${new Date(order.timestamp).toLocaleString()}
                                    <span class="ms-auto badge bg-success">Total: ${formatPrice(order.total)}</span>
                                </button>
                            </h2>
                            <div id="collapse${index}" class="accordion-collapse collapse" aria-labelledby="heading${index}" data-bs-parent="#orderAccordion">
                                <div class="accordion-body">
                                    <h6>Détails du client:</h6>
                                    <p><strong>Nom:</strong> ${order.customer.fullName}</p>
                                    <p><strong>Téléphone:</strong> ${order.customer.phoneNumber}</p>
                                    <p><strong>Adresse:</strong> ${order.customer.address}</p>
                                    <h6>Articles commandés:</h6>
                                    <ul class="list-group mb-3">
                                        ${order.items.map(item => `
                                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                                ${item.title} x ${item.quantity}
                                                <span class="badge bg-secondary rounded-pill">${formatPrice(item.price * item.quantity)}</span>
                                            </li>
                                        `).join('')}
                                    </ul>
                                    <p class="text-end fw-bold">Grand Total: ${formatPrice(order.total)}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });
                orderHistoryHtml += '</div>';
                appContent.innerHTML = orderHistoryHtml; // Injecte le HTML dans le DOM
                console.log('Historique des commandes affiché.');
            }


            // --- Fonctions de logique du panier ---

            /**
             * Ajoute un produit au panier ou augmente sa quantité s'il est déjà présent.
             * @param {number} productId - L'ID du produit à ajouter.
             */
            function addProductToCart(productId) {
                const product = allProducts.find(p => p.id === productId); // Utilise allProducts
                if (!product) {
                    console.warn('Produit non trouvé pour l\'ajout au panier:', productId);
                    return; // Si le produit n'est pas trouvé, ne rien faire
                }

                const existingItem = cart.find(item => item.id === productId);
                if (existingItem) {
                    existingItem.quantity++; // Incrémente la quantité
                    console.log('Quantité du produit existant augmentée:', existingItem);
                } else {
                    cart.push({ ...product, quantity: 1 }); // Ajoute le produit avec une quantité de 1
                    console.log('Nouveau produit ajouté au panier:', product);
                }
                localStorage.setItem('cart', JSON.stringify(cart)); // Sauvegarde le panier dans le localStorage
                updateCartCount(); // Met à jour le compteur
                showToast('Article ajouté au panier !', 'success'); // Affiche une notification
            }

            /**
             * Modifie la quantité d'un article dans le panier.
             * @param {number} productId - L'ID du produit.
             * @param {number} delta - La valeur à ajouter ou soustraire à la quantité (ex: 1 pour augmenter, -1 pour diminuer).
             */
            function changeQuantity(productId, delta) {
                const itemIndex = cart.findIndex(item => item.id === productId);
                if (itemIndex > -1) {
                    cart[itemIndex].quantity += delta;
                    if (cart[itemIndex].quantity <= 0) {
                        removeProductFromCart(productId); // Supprime l'article si la quantité est <= 0
                        console.log('Article retiré du panier car quantité <= 0:', productId);
                    } else {
                        localStorage.setItem('cart', JSON.stringify(cart));
                        renderCartItems(); // Re-rend le panier pour refléter le changement
                        console.log('Quantité modifiée pour le produit:', productId, 'nouvelle quantité:', cart[itemIndex].quantity);
                    }
                } else {
                    console.warn('Impossible de modifier la quantité, article non trouvé dans le panier:', productId);
                }
            }

            /**
             * Retire un produit du panier.
             * @param {number} productId - L'ID du produit à retirer.
             */
            function removeProductFromCart(productId) {
                cart = cart.filter(item => item.id !== productId); // Filtre le panier pour retirer l'article
                localStorage.setItem('cart', JSON.stringify(cart)); // Sauvegarde le panier
                renderCartItems(); // Re-rend le panier
                showToast('Article retiré du panier.', 'info'); // Affiche une notification
                console.log('Produit retiré du panier:', productId);
            }

            // --- Gestion de la commande ---

            /**
             * Gère la soumission du formulaire de commande.
             * @param {Event} event - L'événement de soumission du formulaire.
             */
            async function handleCheckoutSubmit(event) {
                event.preventDefault(); // Empêche le rechargement de la page
                console.log('Soumission du formulaire de commande...');

                // Récupération des données du formulaire
                const fullName = document.getElementById('fullName').value;
                const phoneNumber = document.getElementById('phoneNumber').value;
                const address = document.getElementById('address').value;

                if (cart.length === 0) {
                    showToast('Votre panier est vide. Veuillez ajouter des articles.', 'warning');
                    console.warn('Tentative de commande avec un panier vide.');
                    return;
                }

                // Création de l'objet de détails de la commande
                const orderDetails = {
                    orderId: 'ORD-' + Math.random().toString(36).substr(2, 9).toUpperCase(), // Génère un ID unique
                    timestamp: new Date().toISOString(), // Date et heure de la commande
                    customer: {
                        fullName: fullName,
                        phoneNumber: phoneNumber,
                        address: address
                    },
                    items: cart.map(item => ({ // Mappe les articles du panier pour l'historique
                        id: item.id,
                        title: item.title,
                        price: item.price,
                        quantity: item.quantity,
                        image: item.image
                    })),
                    total: calculateCartTotal(),
                    paymentStatus: 'pending_on_delivery' // Indique que le paiement est sur place
                };
                console.log('Détails de la commande préparés:', orderDetails);

                // Simuler l'envoi de la commande à un backend (ici, via Fake Store API POST)
                // Dans un environnement réel, cette requête serait envoyée à votre API WooCommerce.
                try {
                    // Envoyer un produit générique comme simulation de commande à Fake Store API.
                    // La Fake Store API ne gère pas de vraies commandes, c'est une démonstration.
                    const dummyOrderProduct = {
                        title: `Commande JJ-Commerce #${orderDetails.orderId} de ${fullName}`,
                        price: orderDetails.total,
                        description: `Articles: ${orderDetails.items.map(item => `${item.title} x ${item.quantity}`).join(', ')}. Téléphone: ${phoneNumber}. Adresse: ${address}.`,
                        image: 'https://placehold.co/600x400/0084ff/ffffff?text=JJ-Commerce+Order', // Image générique pour la simulation
                        category: 'orders'
                    };

                    const response = await fetch('https://fakestoreapi.com/products', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dummyOrderProduct)
                    });

                    if (!response.ok) {
                        throw new Error(`Erreur HTTP: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log('Commande simulée envoyée à Fake Store API:', data);

                    // Simuler l'envoi d'e-mail au propriétaire
                    // C'est une simulation côté client. Dans un vrai backend, vous utiliseriez un service d'envoi d'e-mail.
                    console.log(`
                        --- NOTIFICATION PAR EMAIL (SIMULÉE) ---
                        À: proprietaire@domaine.com
                        Sujet: Nouvelle commande JJ-Commerce #${orderDetails.orderId} reçue !
                        Contenu:
                        Un utilisateur a passé une nouvelle commande sur JJ-Commerce :
                        Nom: ${fullName}
                        Téléphone: ${phoneNumber}
                        Adresse: ${address}
                        Total: ${formatPrice(orderDetails.total)}
                        Articles:
                        ${orderDetails.items.map(item => `- ${item.title} x ${item.quantity} (${formatPrice(item.price)})`).join('\n')}
                        --- FIN DE NOTIFICATION (SIMULÉE) ---
                    `);

                    // Stocker la commande dans l'historique local du navigateur
                    const orderHistory = JSON.parse(localStorage.getItem('orderHistory')) || [];
                    orderHistory.push(orderDetails);
                    localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
                    console.log('Commande ajoutée à l\'historique local.');


                    // Afficher la modale de confirmation
                    orderNumberDisplay.textContent = orderDetails.orderId;
                    orderConfirmationModal.show();
                    console.log('Modale de confirmation de commande affichée.');

                    // Vider le panier après la commande
                    cart = [];
                    localStorage.setItem('cart', JSON.stringify(cart));
                    updateCartCount(); // Met à jour le compteur du panier
                    renderCartItems(); // Met à jour la modale du panier (qui sera fermée par la suite)
                    console.log('Panier vidé.');

                    // Rediriger vers la page d'accueil après un court délai pour la confirmation
                    setTimeout(() => {
                        orderConfirmationModal.hide(); // Cache la modale de confirmation
                        renderProducts(); // Revenir à la page des produits
                        console.log('Redirection vers la page d\'accueil après confirmation.');
                    }, 3000);

                } catch (error) {
                    console.error('Erreur lors de la confirmation de commande ou de l\'envoi simulé:', error);
                    showToast('Une erreur est survenue lors de la commande. Veuillez réessayer.', 'danger');
                }
            }


            // --- Toasts (Notifications) ---
            /**
             * Affiche une notification "toast" en bas à droite de l'écran.
             * @param {string} message - Le message à afficher.
             * @param {string} type - Le type de toast (ex: 'success', 'info', 'warning', 'danger').
             */
            function showToast(message, type = 'info') {
                // Crée le conteneur de toasts s'il n'existe pas
                const toastContainer = document.querySelector('.toast-container') || (() => {
                    const div = document.createElement('div');
                    div.classList.add('toast-container', 'position-fixed', 'bottom-0', 'end-0', 'p-3');
                    document.body.appendChild(div);
                    return div;
                })();

                // Génère le HTML du toast
                const toastHtml = `
                    <div class="toast align-items-center text-white bg-${type} border-0" role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="d-flex">
                            <div class="toast-body">
                                ${message}
                            </div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                    </div>
                `;
                toastContainer.insertAdjacentHTML('beforeend', toastHtml); // Ajoute le toast au conteneur
                const toastEl = toastContainer.lastElementChild; // Récupère l'élément toast
                const toast = new bootstrap.Toast(toastEl); // Initialise le composant Bootstrap Toast
                toast.show(); // Affiche le toast
                // Supprime le toast du DOM une fois qu'il est caché
                toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove());
                console.log('Toast affiché:', message, type);
            }

            /**
             * Filtre les produits en fonction de la chaîne de recherche et les affiche.
             * @param {string} query - La chaîne de recherche.
             */
            function filterProducts(query) {
                const lowerCaseQuery = query.toLowerCase();
                const filtered = allProducts.filter(product =>
                    product.title.toLowerCase().includes(lowerCaseQuery) ||
                    product.description.toLowerCase().includes(lowerCaseQuery) ||
                    product.category.toLowerCase().includes(lowerCaseQuery)
                );
                renderProducts(filtered);
                console.log(`Produits filtrés pour la recherche "${query}":`, filtered.length, 'articles.');
            }


            // --- Écouteurs d'événements globaux ---
            // Ouvre la modale du panier et met à jour son contenu
            cartBtn.addEventListener('click', () => {
                console.log('Bouton panier cliqué.');
                renderCartItems();
                cartModal.show();
            });

            // Passe du panier au formulaire de commande
            checkoutBtn.addEventListener('click', () => {
                console.log('Bouton "Passer la commande" cliqué.');
                cartModal.hide(); // Ferme la modale du panier
                renderCheckoutForm(); // Affiche le formulaire de commande
            });

            // Navigue vers la page d'accueil (produits)
            // Lorsque le logo JJ-Commerce est cliqué, il agit comme le lien "Accueil"
            document.querySelector('.navbar-brand').addEventListener('click', (e) => {
                e.preventDefault();
                console.log('Logo JJ-Commerce cliqué. Redirection vers l\'accueil.');
                searchInput.value = ''; // Efface la barre de recherche desktop
                searchInputMobile.value = ''; // Efface la barre de recherche mobile
                renderProducts(); // Affiche tous les produits
                // Gère la classe 'active' pour la navigation
                document.querySelectorAll('.navbar-nav .nav-link').forEach(link => link.classList.remove('active'));
                homeLink.classList.add('active');
            });

            homeLink.addEventListener('click', (e) => {
                e.preventDefault(); // Empêche le comportement par défaut du lien
                console.log('Lien "Accueil" cliqué.');
                searchInput.value = ''; // Efface la barre de recherche desktop
                searchInputMobile.value = ''; // Efface la barre de recherche mobile
                renderProducts(); // Affiche tous les produits
                // Gère la classe 'active' pour la navigation
                document.querySelectorAll('.navbar-nav .nav-link').forEach(link => link.classList.remove('active'));
                homeLink.classList.add('active');
            });

            // Navigue vers la page de l'historique des commandes
            orderHistoryLink.addEventListener('click', (e) => {
                e.preventDefault(); // Empêche le comportement par défaut du lien
                console.log('Lien "Mes Commandes" cliqué.');
                renderOrderHistory();
                // Gère la classe 'active' pour la navigation
                document.querySelectorAll('.navbar-nav .nav-link').forEach(link => link.classList.remove('active'));
                orderHistoryLink.classList.add('active');
            });

            // Écouteur pour la recherche instantanée (desktop)
            searchInput.addEventListener('keyup', (e) => {
                filterProducts(e.target.value);
            });

            // Écouteur pour la recherche instantanée (mobile)
            searchInputMobile.addEventListener('keyup', (e) => {
                filterProducts(e.target.value);
            });

            // --- Initialisation de l'application ---
            updateCartCount(); // Met à jour le compteur du panier au chargement
            renderProducts(); // Charge les produits et affiche la page d'accueil au démarrage
            console.log('Application JJ-Commerce initialisée.');
        });
    </script>
</body>
</html>
